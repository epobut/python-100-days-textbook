[← Предыдущий урок](12.Множества.md) | *Заключительный урок блока 1*
---

## Часто используемые структуры данных: словари

К настоящему времени мы уже представили вам три контейнерных типа данных в Python (список, кортеж, множество), но эти типы данных все еще недостаточны для решения всех наших проблем. Например, нам нужна переменная для хранения нескольких данных о человеке, включая: имя, возраст, рост, вес, домашний адрес, личный номер телефона, номер телефона для экстренной связи. В этот момент вы обнаружите, что типы список, кортеж и множество, которые мы изучили ранее, не очень подходят.

```python
person1 = ['王大锤', 55, 168, 60, '成都市武侯区科华北路62号1栋101', '13122334455', '13800998877']
person2 = ('王大锤', 55, 168, 60, '成都市武侯区科华北路62号1栋101', '13122334455', '13800998877')
person3 = {'王大锤', 55, 168, 60, '成都市武侯区科华北路62号1栋101', '13122334455', '13800998877'}
```

Множество определенно наименее подходящее, потому что в множестве не может быть повторяющихся элементов. Если возраст и вес человека случайно одинаковы, то в множестве будет на один элемент меньше; аналогично, если личный номер телефона человека и номер для экстренной связи одинаковы, в множестве снова будет на один элемент меньше. С другой стороны, хотя список и кортеж могут сохранить всю информацию о человеке, когда вы хотите получить номер телефона или домашний адрес этого человека, вам сначала нужно знать, какой элемент списка или кортежа является его номером телефона. Короче говоря, в описанном выше сценарии список, кортеж, множество не являются наиболее подходящим выбором. В этом случае нам нужен тип словарь (dictionary), этот тип данных наиболее подходит для объединения связанной информации вместе и может помочь нам решить проблему моделирования реальных объектов в программах Python.

Говоря о слове "словарь", все, конечно, знакомы с ним. В начальной школе у каждого был «Словарь Синьхуа», как показано на рисунке ниже.

<img src="res/day13/xinhua_dictionary.jpg" style="zoom:80%;">

Словарь в программе Python очень похож на словарь в реальной жизни, он организует данные в виде пар ключ-значение (комбинация ключа и значения), мы можем найти соответствующее значение по ключу и выполнить операции. Так же как в «Словаре Синьхуа» каждый иероглиф (ключ) имеет соответствующее объяснение (значение), каждый иероглиф и его объяснение вместе составляют одну запись в словаре, а словарь обычно содержит множество таких записей.

### Создание и использование словарей

В Python создание словаря можно выполнить с использованием синтаксиса литерала `{}`, это аналогично множествам, которые мы изучали на прошлом уроке. Но элементы в `{}` словаря существуют в виде пар ключ-значение, каждый элемент состоит из двух значений, разделенных `:`, перед `:` находится ключ, после `:` — значение, код показан ниже.

```python
xinhua = {
    '麓': '山脚下',
    '路': '道，往来通行的地方；方面，地区：南～货，外～货；种类：他俩是一～人',
    '蕗': '甘草的别名',
    '潞': '潞水，水名，即今山西省的浊漳河；潞江，水名，即云南省的怒江'
}
print(xinhua)
person = {
    'name': '王大锤',
    'age': 55,
    'height': 168,
    'weight': 60,
    'addr': '成都市武侯区科华北路62号1栋101', 
    'tel': '13122334455',
    'emergence contact': '13800998877'
}
print(person)
```

Из приведенного выше кода вы, вероятно, уже поняли, что использование словаря для хранения информации о человеке намного лучше, чем использование списка или кортежа, потому что мы можем использовать ключ перед `:` для обозначения смысла записи, а после `:` находится значение, соответствующее этой записи.

Конечно, если хотите, мы также можем использовать встроенную функцию `dict` или синтаксис генератора словаря для создания словаря, код показан ниже.

```python
# В функции dict (конструкторе) каждая группа параметров — это пара ключ-значение в словаре
person = dict(name='王大锤', age=55, height=168, weight=60, addr='成都市武侯区科华北路62号1栋101')
print(person)  # {'name': '王大锤', 'age': 55, 'height': 168, 'weight': 60, 'addr': '成都市武侯区科华北路62号1栋101'}

# Можно использовать встроенную функцию Python zip для объединения двух последовательностей и создания словаря
items1 = dict(zip('ABCDE', '12345'))
print(items1)  # {'A': '1', 'B': '2', 'C': '3', 'D': '4', 'E': '5'}
items2 = dict(zip('ABCDE', range(1, 10)))
print(items2)  # {'A': 1, 'B': 2, 'C': 3, 'D': 4, 'E': 5}

# Создание словаря с помощью синтаксиса генератора словаря
items3 = {x: x ** 3 for x in range(1, 6)}
print(items3)  # {1: 1, 2: 8, 3: 27, 4: 64, 5: 125}
```

Чтобы узнать, сколько всего пар ключ-значение в словаре, по-прежнему используется функция `len`; если нужно обойти словарь, можно использовать цикл `for`, но нужно обратить внимание, что цикл `for` обходит только ключи словаря. Но не беда, после изучения операции индексации словаря мы можем получить доступ к соответствующему значению через ключ словаря.

```python
person = {
    'name': '王大锤',
    'age': 55,
    'height': 168,
    'weight': 60,
    'addr': '成都市武侯区科华北路62号1栋101'
}
print(len(person))  # 5
for key in person:
    print(key)
```

### Операции со словарями

Для типа словарь операция принадлежности и операция индексации, безусловно, очень важны. Первая может определить, существует ли указанный ключ в словаре, вторая может получить доступ к соответствующему значению через ключ или добавить новую пару ключ-значение в словарь. Стоит отметить, что индексация словаря отличается от индексации списка. Элементы в списке имеют свой порядковый номер, поэтому индекс списка — это целое число; в словаре хранятся пары ключ-значение, поэтому для индексации словаря нужно использовать ключ для доступа к соответствующему значению. **Особенно важно** напомнить всем, что **ключи в словаре должны быть неизменяемого типа**, например целые числа (`int`), числа с плавающей точкой (`float`), строки (`str`), кортежи (`tuple`) и т.д., это требование аналогично требованию типа множество к элементам; очевидно, что список (`list`) и множество (`set`), о которых мы говорили ранее, не могут быть ключами в словаре, сам тип словарь также не может быть ключом в словаре, потому что словарь также является изменяемым типом. Но список, множество, словарь могут быть значениями в словаре, например:

```python
person = {
    'name': '王大锤',
    'age': 55,
    'height': 168,
    'weight': 60,
    'addr': ['成都市武侯区科华北路62号1栋101', '北京市西城区百万庄大街1号'],
    'car': {
        'brand': 'BMW X7',
        'maxSpeed': '250',
        'length': 5170,
        'width': 2000,
        'height': 1835,
        'displacement': 3.0
    }
}
print(person)
```

Посмотрите на код ниже, чтобы понять операции принадлежности и индексации словаря.

```python
person = {'name': '王大锤', 'age': 55, 'height': 168, 'weight': 60, 'addr': '成都市武侯区科华北路62号1栋101'}

# Операция принадлежности
print('name' in person)  # True
print('tel' in person)   # False

# Операция индексации
print(person['name'])
print(person['addr'])
person['age'] = 25
person['height'] = 178
person['tel'] = '13122334455'
person['signature'] = '你的男朋友是一个盖世垃圾，他会踏着五彩祥云去迎娶你的闺蜜'
print(person)

# Циклический обход
for key in person:
    print(f'{key}:\t{person[key]}')
```

Нужно обратить внимание, что при получении значения из словаря через операцию индексации, если указанный ключ отсутствует в словаре, будет вызвано исключение `KeyError`.

### Методы словарей

Методы типа словарь в основном связаны с операциями с парами ключ-значение. Метод `get` может получить соответствующее значение по ключу. В отличие от операции индексации, метод `get` не вызывает исключение, если в словаре нет указанного ключа, а возвращает `None` или указанное значение по умолчанию, код показан ниже.

```python
person = {'name': '王大锤', 'age': 25, 'height': 178, 'addr': '成都市武侯区科华北路62号1栋101'}
print(person.get('name'))       # 王大锤
print(person.get('sex'))        # None
print(person.get('sex', True))  # True
```

Если нужно получить все ключи словаря, можно использовать метод `keys`; если нужно получить все значения словаря, можно использовать метод `values`. У словаря также есть метод `items`, который объединяет ключи и значения в кортежи, с помощью этого метода очень удобно обходить элементы словаря.

```python
person = {'name': '王大锤', 'age': 25, 'height': 178}
print(person.keys())    # dict_keys(['name', 'age', 'height'])
print(person.values())  # dict_values(['王大锤', 25, 178])
print(person.items())   # dict_items([('name', '王大锤'), ('age', 25), ('height', 178)])
for key, value in person.items():
    print(f'{key}:\t{value}')
```

Метод `update` словаря реализует операцию слияния двух словарей. Например, есть два словаря `x` и `y`, при выполнении операции `x.update(y)` значения в `x`, соответствующие одинаковым ключам с `y`, будут обновлены значениями из `y`, а пары ключ-значение, которые есть в `y`, но отсутствуют в `x`, будут напрямую добавлены в `x`, код показан ниже.

```python
person1 = {'name': '王大锤', 'age': 55, 'height': 178}
person2 = {'age': 25, 'addr': '成都市武侯区科华北路62号1栋101'}
person1.update(person2)
print(person1)  # {'name': '王大锤', 'age': 25, 'height': 178, 'addr': '成都市武侯区科华北路62号1栋101'}
```

Если используется Python 3.9 и выше, также можно использовать оператор `|` для выполнения той же операции, код показан ниже.

```python
person1 = {'name': '王大锤', 'age': 55, 'height': 178}
person2 = {'age': 25, 'addr': '成都市武侯区科华北路62号1栋101'}
person1 |= person2
print(person1)  # {'name': '王大锤', 'age': 25, 'height': 178, 'addr': '成都市武侯区科华北路62号1栋101'}
```

Можно удалить элементы из словаря с помощью методов `pop` или `popitem`. Первый возвращает (получает) значение, соответствующее ключу, но если указанный ключ отсутствует в словаре, вызывается ошибка `KeyError`; второй при удалении элемента возвращает (получает) кортеж, состоящий из ключа и значения. Метод `clear` словаря очищает все пары ключ-значение в словаре, код показан ниже.

```python
person = {'name': '王大锤', 'age': 25, 'height': 178, 'addr': '成都市武侯区科华北路62号1栋101'}
print(person.pop('age'))  # 25
print(person)             # {'name': '王大锤', 'height': 178, 'addr': '成都市武侯区科华北路62号1栋101'}
print(person.popitem())   # ('addr', '成都市武侯区科华北路62号1栋101')
print(person)             # {'name': '王大锤', 'height': 178}
person.clear()
print(person)             # {}
```

Как и в случае со списком, удаление элементов из словаря также можно выполнить с помощью ключевого слова `del`. При удалении элемента, если указанный ключ не соответствует значению, также будет вызвана ошибка `KeyError`, конкретный способ показан ниже.

```python
person = {'name': '王大锤', 'age': 25, 'height': 178, 'addr': '成都市武侯区科华北路62号1栋101'}
del person['age']
del person['addr']
print(person)  # {'name': '王大锤', 'height': 178}
```

### Применение словарей

Рассмотрим несколько простых примеров, чтобы увидеть, как использовать тип словарь для решения некоторых практических задач.

**Пример 1**: Ввести отрывок текста, подсчитать, сколько раз встречается каждая английская буква, вывести по убыванию частоты появления.

```python
sentence = input('Введите отрывок текста: ')
counter = {}
for ch in sentence:
    if 'A' <= ch <= 'Z' or 'a' <= ch <= 'z':
        counter[ch] = counter.get(ch, 0) + 1
sorted_keys = sorted(counter, key=counter.get, reverse=True)
for key in sorted_keys:
    print(f'{key} встречается {counter[key]} раз.')
```

Ввод:

```
Man is distinguished, not only by his reason, but by this singular passion from other animals, which is a lust of the mind, that by a perseverance of delight in the continued and indefatigable generation of knowledge, exceeds the short vehemence of any carnal pleasure.
```

Вывод:

```
e встречается 27 раз.
n встречается 21 раз.
a встречается 18 раз.
i встречается 18 раз.
s встречается 16 раз.
t встречается 16 раз.
o встречается 14 раз.
h встречается 13 раз.
r встречается 10 раз.
d встречается 9 раз.
l встречается 9 раз.
g встречается 6 раз.
u встречается 6 раз.
f встречается 6 раз.
c встречается 6 раз.
y встречается 5 раз.
b встречается 5 раз.
m встречается 4 раз.
p встречается 3 раз.
w встречается 2 раз.
v встречается 2 раз.
M встречается 1 раз.
k встречается 1 раз.
x встречается 1 раз.
```

**Пример 2**: В словаре сохранены коды и цены акций, найти акции с ценой выше 100 юаней и создать новый словарь.

> **Примечание**: Можно использовать синтаксис генератора словаря для создания этого нового словаря.

```python
stocks = {
    'AAPL': 191.88,
    'GOOG': 1186.96,
    'IBM': 149.24,
    'ORCL': 48.44,
    'ACN': 166.89,
    'FB': 208.09,
    'SYMC': 21.29
}
stocks2 = {key: value for key, value in stocks.items() if value > 100}
print(stocks2)
```

Вывод:

```
{'AAPL': 191.88, 'GOOG': 1186.96, 'IBM': 149.24, 'ACN': 166.89, 'FB': 208.09}
```

### Заключение

Словарь в программах Python очень похож на словарь в реальной жизни, он позволяет нам **хранить данные в виде пар ключ-значение**, затем **получать доступ к соответствующему значению через ключ**. Словарь — это тип данных, очень **удобный для поиска данных**, но нужно еще раз напомнить всем, что **ключи в словаре должны быть неизменяемого типа**, данные типов список, множество, словарь не могут быть ключами словаря.


[← Предыдущий урок](12.Множества.md) | *Заключительный урок блока 1*
