## Часто используемые структуры данных: кортежи

В предыдущих двух уроках мы объяснили списки в Python — это контейнерный тип данных, через переменную типа список мы можем сохранять несколько данных и через циклы реализовывать массовые операции с данными. Конечно, в Python есть и другие контейнерные типы данных. Далее мы объясним еще один контейнерный тип данных, его название — кортеж (tuple).

### Определение и операции с кортежами

В языке Python кортеж также является последовательностью, состоящей из нескольких элементов в определенном порядке. Разница между кортежем и списком в том, что **кортеж — это неизменяемый тип**, что означает, что после определения переменной типа кортеж элементы в ней нельзя добавлять или удалять, а также нельзя изменять значения элементов. Если попытаться изменить элемент в кортеже, это вызовет ошибку `TypeError` и приведет к сбою программы. Определение кортежа обычно использует синтаксис литерала вида `(x, y, z)`. Кортеж поддерживает те же операторы, что и список. Посмотрим на следующий код.

```python
# Определить трехэлементный кортеж
t1 = (35, 12, 98)
# Определить четырехэлементный кортеж
t2 = ('骆昊', 45, True, '四川成都')

# Посмотреть тип переменной
print(type(t1))  # <class 'tuple'>
print(type(t2))  # <class 'tuple'>

# Посмотреть количество элементов в кортеже
print(len(t1))  # 3
print(len(t2))  # 4

# Операция индексации
print(t1[0])    # 35
print(t1[2])    # 98
print(t2[-1])   # 四川成都

# Операция среза
print(t2[:2])   # ('骆昊', 43)
print(t2[::3])  # ('骆昊', '四川成都')

# Циклический обход элементов кортежа
for elem in t1:
    print(elem)

# Операция принадлежности
print(12 in t1)         # True
print(99 in t1)         # False
print('Hao' not in t2)  # True

# Операция объединения
t3 = t1 + t2
print(t3)  # (35, 12, 98, '骆昊', 43, True, '四川成都')

# Операция сравнения
print(t1 == t3)            # False
print(t1 >= t3)            # False
print(t1 <= (35, 11, 99))  # False
```

Если в кортеже два элемента, мы называем его двухэлементным кортежем; если в кортеже пять элементов, мы называем его пятиэлементным кортежем. Нужно обратить внимание на то, что `()` представляет пустой кортеж, но если в кортеже только один элемент, нужно добавить запятую, иначе `()` будет не синтаксисом литерала кортежа, а скобками для изменения приоритета операций. Поэтому `('hello', )` и `(100, )` — это одноэлементные кортежи, а `('hello')` и `(100)` — это просто строка и целое число. Мы можем проверить это с помощью следующего кода.

```python
a = ()
print(type(a))  # <class 'tuple'>
b = ('hello')
print(type(b))  # <class 'str'>
c = (100)
print(type(c))  # <class 'int'>
d = ('hello', )
print(type(d))  # <class 'tuple'>
e = (100, )
print(type(e))  # <class 'tuple'>
```

### Операции упаковки и распаковки

Когда мы присваиваем несколько значений, разделенных запятыми, одной переменной, несколько значений будут упакованы в кортеж; когда мы присваиваем кортеж нескольким переменным, кортеж будет распакован в несколько значений, которые затем будут присвоены соответствующим переменным, как показано в коде ниже.

```python
# Операция упаковки
a = 1, 10, 100
print(type(a))  # <class 'tuple'>
print(a)        # (1, 10, 100)
# Операция распаковки
i, j, k = a
print(i, j, k)  # 1 10 100
```

При распаковке, если количество распакованных элементов и количество переменных не совпадают, будет вызвано исключение `ValueError` с сообщением об ошибке: `too many values to unpack` (слишком много значений для распаковки) или `not enough values to unpack` (недостаточно значений для распаковки).

```python
a = 1, 10, 100, 1000
# i, j, k = a             # ValueError: too many values to unpack (expected 3)
# i, j, k, l, m, n = a    # ValueError: not enough values to unpack (expected 6, got 4)
```

Есть один способ решить проблему, когда переменных меньше, чем элементов — использовать выражение со звездочкой. С помощью выражения со звездочкой мы можем позволить одной переменной получить несколько значений, код показан ниже. Нужно обратить внимание на два момента: во-первых, переменная, помеченная выражением со звездочкой, становится списком, список содержит 0 или более элементов; во-вторых, в синтаксисе распаковки выражение со звездочкой может появиться только один раз.

```python
a = 1, 10, 100, 1000
i, j, *k = a
print(i, j, k)        # 1 10 [100, 1000]
i, *j, k = a
print(i, j, k)        # 1 [10, 100] 1000
*i, j, k = a
print(i, j, k)        # [1, 10] 100 1000
*i, j = a
print(i, j)           # [1, 10, 100] 1000
i, *j = a
print(i, j)           # 1 [10, 100, 1000]
i, j, k, *l = a
print(i, j, k, l)     # 1 10 100 [1000]
i, j, k, l, *m = a
print(i, j, k, l, m)  # 1 10 100 1000 []
```

Следует отметить, что синтаксис распаковки работает для всех последовательностей, что означает, что списки, последовательности диапазонов, созданные функцией `range`, и даже строки могут использовать синтаксис распаковки. Можете попробовать запустить следующий код и посмотреть, какой будет результат.

```python
a, b, *c = range(1, 10)
print(a, b, c)
a, b, c = [1, 10, 100]
print(a, b, c)
a, *b, c = 'hello'
print(a, b, c)
```

### Обмен значениями переменных

Обмен значениями переменных — это часто используемая операция при написании кода, но во многих языках программирования для обмена значениями двух переменных нужна промежуточная переменная, а если не использовать промежуточную переменную, нужно использовать довольно сложные битовые операции. В Python для обмена значениями двух переменных `a` и `b` достаточно использовать следующий код.

```python
a, b = b, a
```

Аналогично, если нужно обменять значения трех переменных `a`, `b`, `c`, то есть присвоить значение `b` переменной `a`, значение `c` переменной `b`, значение `a` переменной `c`, можно сделать так же.

```python
a, b, c = b, c, a
```

Следует отметить, что приведенная выше операция не использует синтаксис упаковки и распаковки. В инструкциях байт-кода интерпретатора Python есть инструкции `ROT_TWO` и `ROT_THREE`, которые могут напрямую реализовать эту операцию с очень высокой эффективностью. Но если нужно последовательно обменять значения более трех переменных, прямых инструкций байт-кода для этого нет, и нужно использовать упаковку и распаковку для обмена значениями между переменными.

### Сравнение кортежей и списков

Здесь есть очень интересный вопрос для обсуждения: в Python уже есть тип список, зачем еще нужен тип кортеж? Этот вопрос может показаться сложным для начинающих, но ничего страшного, сначала давайте изложим точку зрения, и вы сможете постепенно понять это в процессе обучения.

1. Кортеж — это неизменяемый тип, **неизменяемые типы больше подходят для многопоточных сред**, потому что это снижает накладные расходы на синхронизацию при параллельном доступе к переменным. Об этом мы поговорим позже, когда будем изучать параллельное программирование.

2. Кортеж — это неизменяемый тип, обычно **неизменяемые типы превосходят соответствующие изменяемые типы по времени создания**. Мы можем использовать функцию `timeit` из модуля `timeit`, чтобы посмотреть, сколько времени занимает создание кортежа и списка с одинаковыми элементами. Параметр `number` функции `timeit` указывает количество выполнений кода. В коде ниже мы создали список и кортеж, содержащие целые числа от `1` до `9`, каждая операция выполняется `10000000` раз, и подсчитывается время выполнения.

   ```python
   import timeit
   
   print('%.3f секунд' % timeit.timeit('[1, 2, 3, 4, 5, 6, 7, 8, 9]', number=10000000))
   print('%.3f секунд' % timeit.timeit('(1, 2, 3, 4, 5, 6, 7, 8, 9)', number=10000000))
   ```

   Вывод:

   ```
   0.635 секунд
   0.078 секунд
   ```

   > **Примечание**: Результаты выполнения приведенного выше кода зависят от программно-аппаратной системы. На компьютере, который я сейчас использую, время выполнения `10000000` операций создания списка составляет `0.635` секунд, а время выполнения `10000000` операций создания кортежа — `0.078` секунд. Очевидно, создание кортежа быстрее, и разница составляет порядок величины. Вы можете выполнить этот код на своем компьютере и поделиться результатами в комментариях, посмотрим, чей компьютер мощнее.

Конечно, в Python типы кортеж и список можно взаимно преобразовывать, мы можем выполнить эту операцию с помощью следующего кода.

```python
infos = ('骆昊', 43, True, '四川成都')
# Преобразовать кортеж в список
print(list(infos))  # ['骆昊', 43, True, '四川成都']

frts = ['apple', 'banana', 'orange']
# Преобразовать список в кортеж
print(tuple(frts))  # ('apple', 'banana', 'orange')
```

### Заключение

**Список и кортеж — это контейнерные типы данных**, то есть одна переменная может хранить несколько данных, и оба они являются упорядоченными контейнерами, организующими элементы в определенном порядке. **Список — это изменяемый тип данных**, **кортеж — это неизменяемый тип данных**, поэтому в список можно добавлять элементы, удалять элементы, очищать элементы, сортировать и переворачивать, но эти операции не применимы к кортежу. Список и кортеж поддерживают **операцию объединения**, **операцию принадлежности**, **операцию индексации**, **операцию среза** и другие операции. Строковый тип, о котором мы поговорим позже, также поддерживает эти операции, потому что строка — это последовательность символов в определенном порядке, в этом отношении между ними нет разницы. Мы **рекомендуем использовать синтаксис генератора списков для создания списков** — он не только удобен, но и очень эффективен, это очень характерный синтаксис языка Python.